# Gaps Identified in PRODUCT.md and System Design

> **Note:** Generated by Claude after reading `docs/PRODUCT.md` and `docs/system_design.pdf`. This is a starting point, not an exhaustive list — new gaps may surface during implementation.

Organized by area and tagged with which phase they'll likely need to be resolved in. Address relevant gaps when writing each phase MD file.

---

## App-Level / Navigation

| # | Gap | Details | Relevant Phase |
|---|-----|---------|----------------|
| 1 | **No home screen defined** | What does the user see when they open the app? A "New Session" button? A list of past sessions? The product doc starts at "user types their intent" but doesn't say what comes before that. | Phase 1 |
| 2 | **No session history** | Can the user view past sessions and their reports? If yes, what does that list look like? If no, each session is fire-and-forget. | Phase 1 |
| 3 | **First-time experience / onboarding** | User opens the app for the first time. They need to: enter their API key, grant macOS Accessibility permission. What does this flow look like? | Phase 1 |
| 4 | **API key management** | Where does the user enter their key? Settings screen? First-run wizard? Can they change it later? Where is it stored (SQLite? Electron's safeStorage?)? | Phase 1 |
| 5 | **App lifecycle on launch** | What happens if the app was force-quit during an active session? Is there a "you have an unfinished session" recovery flow? | Phase 5 |
| 6 | **Data management** | Can users delete a session? Delete all data? Export their data? | Later |

---

## Intent Phase

| # | Gap | Details | Relevant Phase |
|---|-----|---------|----------------|
| 7 | **Session creation timing** | Product doc says "Session is created" after intent confirmation. System design says `session:create` also checks intent with AI. So is a session row created immediately (with original_intent), or only after the intent is confirmed as specific? | Phase 2 |
| 8 | **Missing session status: "created"** | Data model has `status (active, paused, ended)`. But after intent is confirmed and before "Start Recording" is clicked, what's the status? There's an implicit state between "session exists" and "capture running." | Phase 2 |
| 9 | **After user edits AI-refined intent** | Does the edited intent go through AI vagueness checking again? Product doc says "Edit button available on refined intent." System design says "Same flow as 1st FR." But does that mean the edit triggers a new AI check, or is the user's edit accepted as-is? | Phase 2 |
| 10 | **Clarifying questions UI** | AI asks 2-3 clarifying questions. How are they displayed? One at a time? All at once? Free-text answers or structured? | Phase 2 |
| 11 | **What if AI intent check fails?** | Network error, invalid API key, rate limit. What does the user see? Can they proceed with their original intent without AI checking? | Phase 2 |

---

## Capture Phase

| # | Gap | Details | Relevant Phase |
|---|-----|---------|----------------|
| 12 | **macOS Accessibility permission** | Getting the active window title on macOS requires the user to grant Accessibility permission in System Preferences. This is a significant first-run blocker not mentioned in either doc. What if the user denies it? | Phase 3 |
| 13 | **Window capture library** | Which npm package for getting the active window? Options: `active-win`, `@peerigon/active-window`, native Swift bridge. Needs a decision. | Phase 3 |
| 14 | **Multiple monitors** | If the user has multiple monitors, do we capture only the focused window? (Likely yes — "active window" implies the one with keyboard focus.) | Phase 3 |
| 15 | **What if capture fails silently?** | If the system call to get the active window fails for any reason, do we skip that capture? Log an error? Alert the user? | Phase 3 |
| 16 | **Recording indicator** | What does the user see while recording? A tray icon? A dot in the app? Something on the floating button? The product doc doesn't define this. | Phase 3 |

---

## Feeling Log

| # | Gap | Details | Relevant Phase |
|---|-----|---------|----------------|
| 17 | **Floating button specs** | Size? Position (corner of screen)? Can the user drag it? Does it have a specific appearance? What happens if it overlaps important content? | Phase 4 |
| 18 | **Text input behavior** | Max character limit? Can the user submit empty text? Multi-line? Does Enter submit or add a newline? | Phase 4 |
| 19 | **"Brief confirmation"** | Product doc says "Brief confirmation, input closes." What does this look like? A checkmark? A toast? How long does it stay visible? | Phase 4 |
| 20 | **Floating window and Electron** | Is the floating button a separate `BrowserWindow`? Or an overlay within the main window? Separate window is needed to float over other apps. | Phase 4 |

---

## Session Management

| # | Gap | Details | Relevant Phase |
|---|-----|---------|----------------|
| 21 | **Auto-end duration** | "Automatically ends after a maximum duration" — what is that duration? 8 hours? 12 hours? Configurable? | Phase 5 |
| 22 | **Auto-end mechanism** | Product doc says "Checked when the user next opens the app." Does that mean there's NO real-time timer? If the user leaves the app open for 24 hours, does it just keep recording? Or is there also a background timer? | Phase 5 |
| 23 | **Pause UI** | What does the app show while paused? A "Session Paused" screen with a resume button? Does the floating button change appearance? | Phase 5 |
| 24 | **Multiple pauses** | Can the user pause and resume multiple times in one session? (Likely yes, but worth confirming.) | Phase 5 |
| 25 | **Starting a new session** | Can the user start a new session while one is paused? Or must they end the current one first? | Phase 5 |
| 26 | **End session UI flow** | How does the user choose between pause and end? Two separate buttons? A menu? The product doc lists three options but not how they're presented. | Phase 5 |

---

## Report

| # | Gap | Details | Relevant Phase |
|---|-----|---------|----------------|
| 27 | **Report JSON structure** | The `reports` table has `summary`, `patterns`, `suggestions` columns. What's the actual data shape? This is critical — the UI needs to parse and render these. Need to define the schema (e.g., `patterns` = array of `{name, confidence, evidence: [{type, text, timestamp}]}`). | Phase 6 |
| 28 | **AI prompt templates** | What do we send to the AI for intent checking? For report generation? The system design says "builds prompts from session data" but doesn't define the prompts. | Phase 2 & 6 |
| 29 | **AI response format** | What structured format do we expect back from the AI? JSON? How do we enforce/validate the structure? What if the AI returns malformed output? | Phase 2 & 6 |
| 30 | **Capture collapsing definition** | "Collapse consecutive identical captures into spans" — what defines "identical"? Same `window_title` AND `app_name`? Or just `app_name`? (e.g., two different tabs in Chrome = same app, different title.) | Phase 6 |
| 31 | **Proof modal** | Report section 2 mentions "ability to view proof in a modal showing the specific capture entries and feeling logs the AI used." How does the AI reference specific captures? By timestamp range? By IDs? The AI needs to output references that map back to raw data. | Phase 6 |
| 32 | **Short session handling** | What if the user records for 2 minutes? Is there enough data for meaningful patterns? Should there be a minimum session length warning? | Phase 6 |
| 33 | **Zero feeling logs** | The AI interpretation relies heavily on feelings for "why." What quality of analysis can the AI provide with zero feeling logs? Should the report acknowledge this limitation? | Phase 6 |
| 34 | **Report generation failure** | What if the AI call fails during report generation? `reports.status` has "failed" — what does the user see? Can they retry? | Phase 6 |
| 35 | **Report generation timing** | Triggered at session end. If AI takes 30+ seconds and user is waiting — is there a progress indicator? Can they navigate away and come back? | Phase 6 |
| 36 | **Pattern confidence criteria** | High, medium, low confidence — is this defined by us in the prompt, or left to the AI's judgment? | Phase 6 |

---

## Data Model / Technical

| # | Gap | Details | Relevant Phase |
|---|-----|---------|----------------|
| 37 | **Primary key types** | UUID vs auto-increment for IDs? UUIDs are safer for a local app (no collision concerns if we ever sync), but auto-increment is simpler. | Phase 1 |
| 38 | **IPC payload types** | Channels are defined (`session:create`, etc.) but the TypeScript types for request/response payloads are not. | Phase 1 |
| 39 | **SQLite column types & constraints** | No types defined (TEXT, INTEGER, etc.), no NOT NULL constraints, no foreign key definitions, no indexes. | Phase 1 |
| 40 | **API key storage security** | Should the API key be stored in SQLite (accessible as plain text) or in Electron's `safeStorage` (encrypted at OS level)? | Phase 1 |
| 41 | **Data sent to AI provider** | Exactly what fields are sent? The system design says data is anonymous (no user identity). But do we send session_id? Timestamps? Need to define the exact payload. | Phase 2 & 6 |
